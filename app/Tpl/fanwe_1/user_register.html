{include file="inc/header_login_register.html"}
<?php
$this->_var['dpagecss'][] = $this->_var['TMPL_REAL']."/css/user_register.css";
$this->_var['dcpagecss'][] = $this->_var['TMPL_REAL']."/css/user_register.css";
$this->_var['dpagecss'][] = $this->_var['TMPL_REAL']."/css/login.css";
$this->_var['dpagejs'][] = $this->_var['TMPL_REAL']."/js/user_register.js";
$this->_var['dcpagejs'][] = $this->_var['TMPL_REAL']."/js/user_register.js";

$this->_var['dpagejs'][] = $this->_var['TMPL_REAL']."/js/ajax_user_login.js";
$this->_var['dcpagejs'][] = $this->_var['TMPL_REAL']."/js/ajax_user_login.js";

?>
<link rel="stylesheet" type="text/css" href="{function name="parse_css" v="$dpagecss"}" />
<script type="text/javascript" src="{function name="parse_script" v="$dpagejs" c="$dcpagejs"}"></script>
<div class="blank"></div>
        <style>
		.container{height:730px;}
.control-label
.form_error,.form_tip{color:red;}
.body{background:#88abda;}
.nav li{float:left;}
.hidden{display:none;}
.c{color:#690}
.c{color:#12ADFF;}
.control-label{width:70px;}
.control-group{ float:left; overflow:visible }
.dlmain {width:1000px; background:url({$TMPL}/images/images/reglog_bg.gif) #fcfcfc repeat-y; }
.tip_box{float:left}
.holder_tip{top:0;left:0;}
.term{margin-left:95px;}
</style>

<script> 

$(document).keydown(function (event) {
if (event.keyCode == 13) {
$("#btn_do_register").click();
}
});

 </script>


<div class="container" style="background:url(app/Tpl/fanwe_1/images/dl_bg.jpg)">
    <div class="login  " style="width:594px;_width:580px;margin-left:33%;border-radius: 20px; margin-top:-10px">
        <div class="login_box">
        <form id="user_register_form" name="user_register_form" action="{url r="user#do_register"}">
                <div class="login_top2">

                    <a href="javascript:;">注册</a>
                </div>
            <div class="login_cont "  >
                <div class="form_row control-group mycontrol-group">
                    <label class="title control-label" style="color:#fff">会员名称</label>
                    <div class="pr f_l">
					    
                        <input type="text" value="" class="textbox" name="user_name"/>
                        <span class="holder_tip">请输入会员帐号</span>
                    </div>
                    <div class="tip_box"></div>
                    <div class="blank0"></div>
                </div>
                <div class="form_row control-group mycontrol-group">
                    <label class="title control-label" style="color:#fff">创建密码</label>
                    <div class="pr f_l">
                        <input type="password" name="user_pwd"  class="textbox" />
                        <span class="holder_tip">至少输入4个字符</span>
                    </div>
                    <div class="tip_box"></div>
                    <div class="blank0"></div>
                </div>
                <div class="form_row control-group mycontrol-group">
                    <label class="title control-label" style="color:#fff">确认密码</label>
                    <div class="pr f_l">
                        <input type="password" name="confirm_user_pwd"  class="textbox" />
                        <span class="holder_tip">至少输入4个字符</span>
                    </div>
                    <div class="tip_box"></div>
                    <div class="blank0"></div>
                </div>
                {if app_conf("USER_VERIFY") neq 2}
                    <div class="form_row control-group mycontrol-group">
                        <label class="title control-label" style="color:#fff">电子邮箱</label>
                        <div class="pr f_l">
                            <input type="text" class="textbox" name="email"/>
                            <span class="holder_tip">请正确输入电子邮箱，可用于密码找回</span>
                        </div>
                        <div class="tip_box"></div>
                        <div class="blank0"></div>
                    </div>
                {/if}
                {if app_conf("USER_VERIFY") eq 1 || app_conf("USER_VERIFY") eq 4 }
                    <div class="form_row control-group mycontrol-group">
                        <label for="signup-email-code" class="title control-label" style="color:#fff">邮件验证</label>
                        <div class="pr f_l">
                            <input type="text control-label" id="settings_email_code" name="verify_coder_email" class="textbox f_l" style="width:50px;margin-right:10px" />
                            <input type="button" value="获取验证码" class="ui-button_active send_sms_verify bg_red" id="J_send_email_verify" />
                        </div>
                        <div class="tip_box"></div>
                        <div class="blank0"></div>
                    </div>
                {/if}
                {if app_conf("USER_VERIFY") eq 2 || app_conf("USER_VERIFY") eq 4}
                    <div class=" form_row control-group mycontrol-group">
                        <label for="signup-mobile control-label" class="title control-label" style="color:#fff">手机号码</label>
                        <div class="pr f_l">
                            <input type="text" value="" class="textbox" id="settings-mobile" name="mobile" size="30">
                            <span class="holder_tip">请输入手机号码11位</span>
                        </div>
                        <div class="tip_box"></div>
                        <span class="f-input-tip"></span>
                        <div class="blank0"></div>
                    </div>
                    <div class="form_row control-group mycontrol-group">
                        <label for="signup-mobile-code" class="title control-label" style="color:#fff">手机验证</label>
                        <div class="pr f_l">
                            <input type="text" id="settings-mobile-code" name="verify_coder" class="textbox f_l" style="width:50px;margin-right:10px" />
                            <input type="button" value="获取验证码" class="send_sms_verify ui-button bg_red f_l" id="J_send_sms_verify" rel="ui-button" />
                        </div>
                        <div class="tip_box f_l"></div>
                        <span class="f-input-tip"></span>
                        <div class="blank0"></div>
                     </div>
                {/if}
                {if app_conf("USER_INVESTMENT") eq 1}
                    <div class="form_row control-group mycontrol-group" style="overflow:visible">
                        <label class="title control-label small_form_lable">会员类型</label>
                        <select name="select_box" id="select_box" class="ui-select field_select small">
                            <option value="0">请选择类型</option>
                            <option value="1">创业者</option>
                            <option value="2">投资者</option>
                        </select>
                        <div class="blank0"></div>
                    </div>
                {/if}
                <div class="blank0"></div>
                <div class="button_row term">
                    <label class="ui_checkbox" rel="agree_register" id="agree_register">
                        <input type="checkbox" value="1" checked="checked" />
                        <a href="{url "help#term"}">《{function name="app_conf" v="SITE_NAME"}服务条款》</a>
                         <a href="{url r="index#index"}" style="color:#0196db;"> 已有账号，去登陆</a>
        </label>
                </div>
                <div class="blank10"></div>
                <div class="button_row do_register control-group">
                    <label class="title control-label"></label>
                    <input type="button" value="注册" name="submit_form" class="ui-button theme_bgcolor" id="btn_do_register" />
                    <input type="hidden" value="1" name="ajax" />
                    <input  type="hidden" name="user_verify" value="{function name="app_conf" v="USER_VERIFY"}" />
                    <div class="blank15"></div>
                </div>
            </form>
        </div>
        <div class="blank"></div>
    </div>
</div>
<script type="text/javascript">
        var code_timeer = null;
        var code_lefttime = 0 ;
$(function(){
    // 同意条款
    $("#agree_register").on('click',function(){
        if($(this).find("input[type='checkbox']").is(':checked')){
            $("#btn_do_register").removeAttr("disabled").addClass("theme_bgcolor").removeClass("bg_gray");
        }
        else{
            $("#btn_do_register").attr("disabled","disabled").addClass("bg_gray").removeClass("theme_bgcolor");
        }
    });

    $(".c_1").show();
    $(".n_1").addClass("c");
    $("#J_send_sms_verify").bind("click",function(){
        send_mobile_verify_sms();
    });

    $("#J_send_email_verify").bind("click",function(){
        email=$("#user_register_form").find("input[name='email']").val();
        send_email_verify(1,email,"#J_send_email_verify");
    });
});

function send_mobile_verify_sms(){

    $("#J_send_sms_verify").unbind("click");
    if(!$.checkMobilePhone($("#settings-mobile").val()))
    {

        form_error($("#settings-mobile"),"手机号码格式错误");
        $("#J_send_sms_verify").bind("click",function(){

            send_mobile_verify_sms();
        });
        return false;
    }

    if(!$.maxLength($("#settings-mobile").val(),11,true))
    {

        $("#settings-mobile").focus();
        $("#settings-mobile").next().show().text("长度不能超过11位");
        $("#settings-mobile").next().css({"color":"red"});
        $("#J_send_sms_verify").bind("click",function(){

            send_mobile_verify_sms();
        });
        return false;
    }

    if($.trim($("#settings-mobile").val()).length == 0)
    {
        form_error($("#settings-mobile"),"{function name="sprintf" format="手机号码不能为空" value="手机号码"}");
        $("#J_send_sms_verify").bind("click",function(){
            send_mobile_verify_sms();
        });
        return false;
    }

    var ajaxurl = APP_ROOT+"/index.php?ctl=ajax&act=check_field";
    var query = new Object();
    query.field_name = "mobile";
    query.field_data = $.trim($("#settings-mobile").val());

    $.ajax({
        url: ajaxurl,
        data:query,
        type: "POST",
        dataType: "json",
        success: function(data){
            if(data.status==1)
            {
                var sajaxurl = APP_ROOT+"/index.php?ctl=ajax&act=send_mobile_verify_code&is_only=1";
                var squery = new Object();
                squery.mobile = $.trim($("#settings-mobile").val());
                $.ajax({
                    url: sajaxurl,
                    data:squery,
                    type: "POST",
                    dataType: "json",
                    success: function(sdata){

                        if(sdata.status==1)
                        {
                            code_lefttime = 60;
                            code_lefttime_func();
                            $.showSuccess(sdata.info);
                            return false;
                        }
                        else
                        {

                            $("#J_send_sms_verify").bind("click",function(){
                                send_mobile_verify_sms();
                            });
                            $.showErr(sdata.info);
                            return false;
                        }
                    }
                });
            }
            else
            {
                $("#J_send_sms_verify").bind("click",function(){
                    send_mobile_verify_sms();
                });
                form_error($("#settings-mobile"),data.info);
                return false;
            }
        }
    });
}
function code_lefttime_func(){
    clearTimeout(code_timeer);
    $("#J_send_sms_verify").val(code_lefttime+"秒后重新发送");
    $("#J_send_sms_verify").css({"color":"#f1f1f1"});
    code_lefttime--;
    if(code_lefttime >0){
        code_timeer = setTimeout(code_lefttime_func,1000);
    }
    else{
        code_lefttime = 60;
        $("#J_send_sms_verify").val("发送验证码");

        $("#J_send_sms_verify").css({"color":"#fff"});
        $("#J_send_sms_verify").bind("click",function(){

            send_mobile_verify_sms();
        });
    }

}
</script>
<div class="blank"></div>
